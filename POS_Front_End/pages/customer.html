<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>POS System</title>
    <meta name="viewport" content="width=device-width initial-scale=1">
    <link rel="stylesheet" href="../assets/css/bootstrap.css">
    <link rel="stylesheet" href="../assets/fontAwesome/css/all.min.css">
</head>
<body>

<header>
    <nav class="navbar navbar-expand-lg bg-transparent border-bottom shadow-lg sticky-top rounded-start rounded-end ">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                <img src="../assets/img/shop.png" alt="Logo" width="40px" height="40px"
                     class="d-inline-block align-text-top">
            </a>
            <a class="navbar-brand" href="#">POS System</a>

            <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                    data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
                    aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item" id="homeBtn">
                        <a class="nav-link" aria-current="page" href="../index.html"><i
                                class="fa-solid fa-house-chimney"></i>
                            Home</a>
                    </li>
                    <li class="nav-item" id="customersBtn">
                        <a class="nav-link" href="customer.html"><i class="fa-solid fa-users"></i> Customers</a>
                    </li>
                    <li class="nav-item" id="itemsBtn">
                        <a class="nav-link" href="item.html"><i class="fa-solid fa-bag-shopping"></i> Items</a>
                    </li>
                    <li class="nav-item" id="placeOrderBtn">
                        <a class="nav-link" href="purchase-order.html"><i class="fa-solid fa-cart-plus"></i>
                            Place Orders</a>
                    </li>
                    <li class="nav-item" id="OrderBtn">
                        <a class="nav-link" href="orderDetails.html"><i class="fa-solid fa-cart-plus"></i>
                            Order Details</a>
                    </li>
                </ul>
                <ul class="navbar-nav me-6 mb-2 mb-lg-0">
                    <li class="nav-item">
                        <a class="nav-link" aria-current="page" href="#"><i class="fa-solid fa-user-plus"></i> Sign
                            Up</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" aria-current="page" href="#"><i class="fa-solid fa-right-from-bracket"></i>
                            Log Out</a>
                    </li>
                </ul>
            </div>

        </div>
    </nav>
</header>


<main class="container-fluid" id="CustomerSection">
    <div class="col-10 container d-flex flex-grow-1 flex-column">
        <div class="position-relative d-inline-block mt-3 mt-lg-4 mt-md-4">
            <h2 style="font-family: 'Arial Narrow MT Bold',serif"><i class="fa-solid fa-users"></i> Customers</h2>
        </div>
    </div>
    <div class="container d-flex flex-grow-1 flex-column shadow rounded-4" style="background-color: #dcdcdc">
        <div class="position-relative d-inline-block mt-3 mt-lg-4 mt-md-4">
            <h6>Home > Customers</h6>
            <hr>
        </div>

        <nav class="navbar justify-content-around">
            <div class=" col-lg-5 p-2 rounded-3" style="background-color: white">
                <h4 class="text-center p-2 text-light rounded-3" style="background: rgba(38,131,255,0.8)">Search
                    Customer</h4>
                <form class="d-flex" role="search">
                    <input class="form-control me-2" type="search" placeholder="Input Name/NIC/Tp Here"
                           aria-label="Search" id="txtCusID">
                    <button class="btn btn-outline-success me-3" type="button" id="btnSearch">Search</button>
                    <button class="btn btn-outline-warning me-3" type="button">Clear</button>
                </form>
            </div>
        </nav>
        <div class="d-grid gap-4 d-md-flex mt-lg-3 justify-content-md-center">
            <button type="button" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#newCustomer">Add New
                Customer
            </button>
            <button type="button" class="btn btn-danger" id="btnDeleteCustomer">Delete Customer</button>
            <button type="button" class="btn btn-warning" data-bs-toggle="modal" data-bs-target="#updateCustomer">Update
                Customer
            </button>
            <button type="button" class="btn btn-info" id="btnGetAll">View All Customers</button>
        </div>

        <div class="row mt-1 mt-md-2 mt-lg-4 justify-content-around" style="height: 250px;">
            <div class="col-10">
                <div class="customerTableDiv overflow-auto" style="height: 200px;">
                    <table class="table  table-bordered border-info" >
                        <thead class="table-primary text-primary text-center ">
                        <tr>
                            <th scope="col">Customer ID</th>
                            <th scope="col">Customer Name</th>
                            <th scope="col">Customer Address</th>
                            <th scope="col">Customer Salary</th>
                        </tr>
                        </thead>
                        <tbody id="tblCustomer" class="text-center" data-bs-toggle="modal"
                               data-bs-target="#updateCustomer"></tbody>
                    </table>
                </div>
            </div>
        </div>

    </div>

    <div class="modal fade" id="newCustomer" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-success-subtle">
                    <h5 class="modal-title">New Customer</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form class="ubFt" id="CustomerSaveForm">
                        <div class="ms-3 me-3">
                            <label for="customer-id" class="col-form-label">Customer ID:</label>
                            <input name="cusID" type="text" class="form-control" id="customer-id">
                            <small class="control-error text-danger" id="lblCus-ID"></small>
                        </div>
                        <div class="ms-3 me-3">
                            <label for="customer-name" class="col-form-label">Customer Name:</label>
                            <input name="cusName" type="text" class="form-control" id="customer-name">
                            <small class="control-error text-danger" id="lblCus-Name"></small>
                        </div>
                        <div class="ms-3 me-3">
                            <label for="customer-address" class="col-form-label">Customer Address:</label>
                            <input name="cusAddress" type="text" class="form-control" id="customer-address">
                            <small class="control-error text-danger" id="lblCus-Address"></small>
                        </div>
                        <div class="ms-3 me-3">
                            <label for="customer-salary" class="col-form-label">Customer Salary:</label>
                            <input name="cusSalary" type="text" class="form-control" id="customer-salary">
                            <small class="control-error text-danger" id="lblCus-Salary"></small>
                        </div>
                    </form>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-outline-success" id="saveCustomer">Save</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="updateCustomer" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-warning-subtle">
                    <h5 class="modal-title">Update Customer</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form class="ubFt" id="CustomerUpdateForm">
                        <div class="ms-3 me-3">
                            <label for="customerId" class="col-form-label">Customer ID:</label>
                            <input type="text" class="form-control" id="customerId">
                            <small class="control-error text-danger" id="lblCusID"></small>
                        </div>
                        <div class="ms-3 me-3">
                            <label for="customerName" class="col-form-label">Customer Name:</label>
                            <input type="text" class="form-control" id="customerName">
                            <small class="control-error text-danger" id="lblCusName"></small>
                        </div>
                        <div class="ms-3 me-3">
                            <label for="customerAddress" class="col-form-label">Customer Address:</label>
                            <input type="text" class="form-control" id="customerAddress">
                            <small class="control-error text-danger" id="lblCusAddress"></small>
                        </div>
                        <div class="ms-3 me-3">
                            <label for="customerSalary" class="col-form-label">Customer Salary:</label>
                            <input type="text" class="form-control" id="customerSalary">
                            <small class="control-error text-danger" id="lblCusSalary"></small>
                        </div>
                    </form>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-outline-warning" id="updateCustomerBtn">Update</button>
                </div>
            </div>
        </div>
    </div>

</main>

<script src="../assets/js/jquery-3.7.0.min.js"></script>

<script src="../assets/js/bootstrap.js"></script>

<script src="../assets/validations/CustomerValidations.js"></script>

<script>

    getAllCustomers();

    function getAllCustomers() {
        $("#tblCustomer").empty();

        $.ajax({
            url: 'http://localhost:8080/Back_End/pages/customer',
            dataType: "json",
            success: function (res) {
                console.log(res);
                for (let customer of res.data) {
                    let row = `<tr><td>${customer.id}</td><td>${customer.name}</td><td>${customer.address}</td><td>${customer.salary}</td></tr>`;
                    $("#tblCustomer").append(row);
                }
                bindCustomerTrEvents();

            }
        });
    }

    $("#btnGetAll").click(function () {
        getAllCustomers();
    });

    $("#saveCustomer").click(function () {
        let formData = $("#CustomerSaveForm").serialize();
        console.log(formData)

        $.ajax({
            url: 'http://localhost:8080/Back_End/pages/customer',
            method: "post",
            data: formData,
            success: function (res) {
                alert(res.message);
                getAllCustomers();
                clearSaveFormFields();
            },
            error: function (error) {
                alert(error.responseJSON.message);
                clearSaveFormFields();
            }
        });
    });

    $("#btnDeleteCustomer").click(function () {
        let cusID = $("#txtCusID").val();

        $.ajax({
            url: 'http://localhost:8080/Back_End/pages/customer?cusID=' + cusID,
            method: "delete",
            success: function (res) {
                alert(res.message);
                getAllCustomers();
                return true;
            },
            error: function (error) {
                alert(error.responseJSON.message);
                return false;
            }

        });
    });

    $("#btnSearch").click(function () {
        let cusID = $("#txtCusID").val();
        $("#tblCustomer").empty();

        $.ajax({
            url: 'http://localhost:8080/Back_End/pages/customer',
            method: "get",
            success: function (res) {
                console.log(res.message);
                for (let customer of res.data) {
                    if (cusID==customer.id) {
                        let row = `<tr><td>${customer.id}</td><td>${customer.name}</td><td>${customer.address}</td><td>${customer.salary}</td></tr>`;
                        $("#tblCustomer").append(row);
                    }
                }
            },
            error: function (error) {
                alert(error.responseJSON.message);
            }

        });
    });

    $("#updateCustomerBtn").click(function () {
        let cusID = $("#customerId").val();
        let cusName = $("#customerName").val();
        let cusAddress = $("#customerAddress").val();
        let cusSalary = $("#customerSalary").val();

        let customer = {
            "customerId": cusID,
            "customerName": cusName,
            "customerAddress": cusAddress,
            "customerSalary": cusSalary
        }

        $.ajax({
            url: 'http://localhost:8080/Back_End/pages/customer',
            method: "put",
            contentType: "application/json",
            data:JSON.stringify(customer),
            success: function (res) {
                alert(res.message);
                getAllCustomers();
                clearUpdateFormFields();
            },
            error: function (error) {
                alert(error.responseJSON.message);
                clearUpdateFormFields();
            }
        });
    });

    function bindCustomerTrEvents() {
        $("#tblCustomer>tr").click(function (eData) {
            $("#customerId").val($(this).children().eq(0).text());
            $("#customerName").val($(this).children().eq(1).text());
            $("#customerAddress").val($(this).children().eq(2).text());
            $("#customerSalary").val($(this).children().eq(3).text());
        });
    }

    function clearSaveFormFields() {
        $("#customer-id,#customer-name,#customer-address,#customer-salary").val("");
        $("#customer-id").focus();
    }

    $('#newCustomer').click(function (e) {
        $("#customer-id").focus();
    });

    $('#updateCustomer').click(function (e) {
        $("#customerId").focus();
    });

    function clearUpdateFormFields() {
        $("#customerId,#customerName,#customerAddress,#customerSalary").val("");
        $("#customerId").focus();
    }

</script>

</body>
</html>